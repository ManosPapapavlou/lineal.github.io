<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EC2 / Typologio Shear Design (Vanilla JS)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1020; --panel:#121a32; --ink:#eaf0ff; --muted:#a9b3d0; --accent:#7aa2ff; --ok:#34d399; --warn:#f59e0b; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial; background:var(--bg); color:var(--ink)}
    .wrap{max-width:1000px; margin:40px auto; padding:0 16px}
    .title{font-size:clamp(22px,3vw,34px); font-weight:700; letter-spacing:.3px; margin-bottom:18px}
    .grid{display:grid; gap:16px}
    @media(min-width:880px){ .grid{grid-template-columns:1.1fr .9fr} }
    .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h2{margin:0 0 12px; font-size:18px}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input,select,textarea{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.1);
      background:#0f1630; color:var(--ink); outline:none; font-size:14px
    }
    .row{display:grid; gap:12px; grid-template-columns:repeat(2,1fr)}
    .row3{display:grid; gap:12px; grid-template-columns:repeat(3,1fr)}
    .btn{
      display:inline-block; padding:10px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.1);
      background:linear-gradient(180deg,#2a3a7a,#1f2a5c); color:#fff; font-weight:600; cursor:pointer
    }
    .btn:active{transform:translateY(1px)}
    .muted{color:var(--muted); font-size:13px}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; background:#0f1736; border:1px solid rgba(255,255,255,.08); color:var(--muted)}
    .out{
      display:grid; gap:10px;
    }
    .kv{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px; border-radius:14px; background:#0e1531; border:1px solid rgba(255,255,255,.06)
    }
    .kv .k{color:var(--muted); font-size:13px}
    .kv .v{font-weight:700}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .inline{display:flex; align-items:center; gap:10px}
    .sr-only{position:absolute; left:-10000px; width:1px; height:1px; overflow:hidden}
    .section-title{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">EC2 / Typologio Shear Design • RC Beam</div>

    <div class="grid">
      <!-- Inputs -->
      <div class="card">
        <div class="section-title">
          <h2>Inputs</h2>
          <span class="pill">MPa in N/mm² • lengths in mm • forces in N</span>
        </div>

        <div class="row3">
          <div>
            <label>bw — Section width (mm)</label>
            <input id="bw" type="number" step="1" value="300">
          </div>
          <div>
            <label>d — Effective depth (mm)</label>
            <input id="d" type="number" step="1" value="1000">
          </div>
          <div>
            <label>NEd — Axial force (N)</label>
            <input id="NEd" type="number" step="1" value="0">
          </div>
        </div>

        <div class="row3" style="margin-top:12px">
          <div>
            <label>fck — Concrete strength (MPa)</label>
            <input id="fck" type="number" step="0.1" value="16">
          </div>
          <div>
            <label>fyk — Steel yield (MPa)</label>
            <input id="fyk" type="number" step="1" value="500">
          </div>
          <div>
            <label>Longitudinal tension reinforcement (e.g., 2Φ14 or 4Φ20+2Φ16)</label>
            <input id="oplismos" type="text" value="2Φ14">
          </div>
        </div>

        <div class="row3" style="margin-top:12px">
          <div>
            <label>Stirrup diameter φ (mm)</label>
            <input id="phi_stirrup" type="number" step="1" value="10">
          </div>
          <div>
            <label>Legs per stirrup</label>
            <input id="legs" type="number" step="1" value="2">
          </div>
          <div>
            <label>Stirrup spacing s (mm)</label>
            <input id="s" type="number" step="1" value="100">
          </div>
        </div>

        <div class="row3" style="margin-top:12px">
          <div>
            <label>θ (deg)</label>
            <input id="theta_deg" type="number" step="0.1" value="45">
          </div>
          <div>
            <label>α (deg)</label>
            <input id="alpha_deg" type="number" step="0.1" value="90">
          </div>
          <div>
            <label class="sr-only">.</label>
            <button class="btn" style="width:100%; height:40px; margin-top:22px" id="btnCalc">Calculate</button>
          </div>
        </div>

        <hr style="border-color: rgba(255,255,255,.08); margin:18px 0">

        <div class="inline" style="margin-bottom:8px">
          <input id="diag_check" type="checkbox" />
          <label for="diag_check" style="margin:0">Include diagonal reinforcement</label>
        </div>
        <div class="row">
          <div>
            <label>Diagonal reinforcement (e.g., 3Φ14+1Φ20)</label>
            <input id="oplismos_diag" type="text" value="3Φ14+1Φ20" disabled>
          </div>
          <div class="row">
            <div>
              <label>θ<sub>d</sub> (deg)</label>
              <input id="theta_d_deg" type="number" step="0.1" value="45" disabled>
            </div>
            <div>
              <label>α<sub>d</sub> (deg)</label>
              <input id="alpha_d_deg" type="number" step="0.1" value="45" disabled>
            </div>
          </div>
        </div>
        <p class="muted" style="margin-top:8px">
          Note: This calculator implements your original formulas exactly (including <code>As1 / 10</code> in the diagonal term).
        </p>
      </div>

      <!-- Outputs -->
      <div class="card">
        <div class="section-title">
          <h2>Results</h2>
          <span class="pill">kN output</span>
        </div>
        <div class="out" id="out">
          <div class="kv"><div class="k">VRd,c (Concrete)</div><div class="v" id="VRdc">—</div></div>
          <div class="kv"><div class="k">VRd,s (Stirrups)</div><div class="v" id="VRds">—</div></div>
          <div class="kv"><div class="k">VRd,spasto (Diagonal)</div><div class="v" id="VRdspasto">—</div></div>
          <div class="kv"><div class="k">VRd,max (Limit)</div><div class="v" id="VRdmax">—</div></div>
          <div class="kv"><div class="k">VRd,total</div><div class="v" id="VRd_total">—</div></div>
          <div class="kv"><div class="k">Check</div><div class="v" id="check">—</div></div>
        </div>
        <p class="muted" style="margin-top:10px">
          If <strong>VRd,total &gt; VRd,max</strong>, the available strength should be capped at VRd,max.
        </p>
      </div>
    </div>
  </div>

  <script>
    // --- Utilities ---
    function toNumber(elId){ return Number(document.getElementById(elId).value); }
    function setText(elId, txt){ document.getElementById(elId).textContent = txt; }
    function fmtKN(v){ return isFinite(v) ? (v/1e3).toFixed(2) + " kN" : "—"; }
    function deg2rad(d){ return d * Math.PI / 180; }
    function cot(x){ return 1 / Math.tan(x); }

    // Parse reinforcement string like "4Φ20+2Φ16"
    // Returns As_cm2 (cm²) by summing n * π*(φ/10)^2 / 4
    function parseRebarString(str){
      if(!str || typeof str !== "string") return 0;
      // Split by Φ / φ / + ; keep numbers
      const parts = str.split(/Φ|φ|\+/g).map(s => s.trim()).filter(Boolean);
      // Convert to numbers
      const nums = parts.map(x => Number(x));
      let As_cm2 = 0;
      for(let i=0; i<nums.length-1; i+=2){
        const n = nums[i], phi = nums[i+1];
        if(Number.isFinite(n) && Number.isFinite(phi)){
          As_cm2 += n * Math.PI * Math.pow(phi/10, 2) / 4; // φ in mm -> cm via /10
        }
      }
      return As_cm2; // cm²
    }

    // Enable/disable diagonal fields
    const diagCheck = document.getElementById('diag_check');
    const diagFields = ['oplismos_diag','theta_d_deg','alpha_d_deg'];
    diagCheck.addEventListener('change', () => {
      const on = diagCheck.checked;
      diagFields.forEach(id => {
        const el = document.getElementById(id);
        el.disabled = !on;
        el.style.opacity = on ? 1 : 0.6;
      });
    });

    // Main calculation
    document.getElementById('btnCalc').addEventListener('click', () => {
      // === Inputs ===
      const bw  = toNumber('bw');              // mm
      const d   = toNumber('d');               // mm
      const fck = toNumber('fck');             // MPa (N/mm²)
      const fyk = toNumber('fyk');             // MPa
      const oplismos = document.getElementById('oplismos').value;
      const NEd = toNumber('NEd');             // N
      const phi_stirrup = toNumber('phi_stirrup'); // mm
      const legs = toNumber('legs');           // -
      const s = toNumber('s');                 // mm
      const theta_deg = toNumber('theta_deg');
      const alpha_deg = toNumber('alpha_deg');

      // === Constants ===
      const gamma_c = 1.5;
      const gamma_s = 1.15;
      const alpha_cc = 0.85;
      const fcd = alpha_cc * fck / gamma_c;
      const fyd = fyk / gamma_s; // not directly used; keep for parity
      const z = 0.9 * d;

      // Longitudinal reinforcement area Asl (mm²), following your MATLAB:
      // First compute As_cm2 from string; then Asl_mm2 = As_cm2 * 100
      const As_cm2 = parseRebarString(oplismos);
      const Asl_mm2 = As_cm2 * 100;

      const Ac = bw * d; // mm²
      const Asw = legs * (Math.PI * Math.pow(phi_stirrup, 2) / 4); // mm² per stirrup
      const rho_l = Math.min(Asl_mm2 / (bw * d), 0.02);

      // sigma_cp
      let sigma_cp = Math.max(0, NEd / Ac);          // N/mm²
      sigma_cp = Math.min(sigma_cp, 0.2 * fcd);

      const k = Math.min(1 + Math.sqrt(200 / d), 2.0);

      const fctm = 0.3 * Math.pow(fck, 2/3);
      const fctd = fctm / gamma_c; // not used in your original; kept for parity
      const vmin = 0.035 * Math.pow(k, 1.5) * Math.sqrt(fck);

      const CRdc = 0.18 / gamma_c;
      const k1 = 0.15;

      // Angles
      const theta = deg2rad(theta_deg);
      const alpha = deg2rad(alpha_deg);
      const fywd = fyk / gamma_s;

      // === 1. VRd,c ===
      const VRdc1 = (CRdc * k * Math.pow(100 * rho_l * fck, 1/3) + k1 * sigma_cp) * bw * d;
      const VRdc2 = (vmin + k1 * sigma_cp) * bw * d;
      const VRdc = Math.max(VRdc1, VRdc2);

      // === 2. VRd,s ===
      const VRds = (Asw / s) * z * fywd * (cot(theta) + cot(alpha)) * Math.sin(alpha);

      // === 3. VRd,max ===
      const nu1 = 0.6 * (1 - fck / 250);
      const VRdmax = bw * z * nu1 * fcd * (cot(theta) + cot(alpha)) / (1 + Math.pow(cot(theta), 2));

      // === 4. Optional diagonal reinforcement (exactly as in your code) ===
      let VRdspasto = 0;
      if (diagCheck.checked) {
        const oplismos1 = document.getElementById('oplismos_diag').value;
        const As1_cm2 = parseRebarString(oplismos1); // cm²
        const theta1 = deg2rad(toNumber('theta_d_deg'));
        const alpha1 = deg2rad(toNumber('alpha_d_deg'));
        // NOTE: Matches your MATLAB exactly: VRdspasto = As1 / 10 * z * fywd * (cot(theta1)+cot(alpha1)) * sin(alpha1)
        VRdspasto = (As1_cm2 / 10) * z * fywd * (cot(theta1) + cot(alpha1)) * Math.sin(alpha1);
      }

      // === Totals & checks ===
      const VRd_total = VRdc + VRds + VRdspasto;

      // Update UI
      setText('VRdc', fmtKN(VRdc));
      setText('VRds', fmtKN(VRds));
      setText('VRdspasto', fmtKN(VRdspasto));
      setText('VRdmax', fmtKN(VRdmax));
      setText('VRd_total', fmtKN(VRd_total));

      const checkEl = document.getElementById('check');
      if (VRd_total > VRdmax) {
        checkEl.innerHTML = '<span class="bad">⚠️ VRd,total exceeds VRd,max. Cap strength to VRd,max.</span>';
      } else {
        checkEl.innerHTML = '<span class="ok">OK — VRd,total ≤ VRd,max</span>';
      }
    });

    // Initial calculate
    document.getElementById('btnCalc').click();
  </script>
</body>
</html>
