<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pushover Bilinearization & Fragility (HTML/JS)</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        footer.footer {
  border-top: 1px solid #e9ecef;
  background: #fff;
  color: #6c757d;
}
footer.footer a { color: inherit; text-decoration: underline; }

        body {
            background: #f8f9fa;
        }

        .card {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        }

        textarea.form-control {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        .small-note {
            font-size: .9rem;
            color: #6c757d;
        }

        .form-floating>.form-control::placeholder {
            color: transparent;
        }

        .pill {
            padding: .35rem .6rem;
            border-radius: 999px;
            background: #f1f3f5;
        }

        .table-sm td,
        .table-sm th {
            padding: .3rem .5rem;
        }

        .sticky-head {
            position: sticky;
            top: 0;
            background: #fff;
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <div class="d-flex align-items-center mb-3">
            <h1 class="h3 mb-0">Pushover Bilinearization & Fragility</h1>
            <span class="ms-3 pill">units: δ in <strong>mm</strong>, V<sub>b</sub> in <strong>kN</strong></span>
        </div>

        <div class="row g-4">
            <!-- Left: Inputs -->
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-body">
                        <h2 class="h5">Inputs</h2>
                        <div class="row g-3">
                            <div class="col-6">
                                <label class="form-label">Safety factor (grd)</label>
                                <input id="grd" type="number" step="0.01" class="form-control" value="1.5">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Target displacement (dt, mm)</label>
                                <input id="dt" type="number" step="0.01" class="form-control" value="16.6">
                            </div>

                            <div class="col-12">
                                <label class="form-label mb-1">Betas (β<sub>DL</sub>, β<sub>SD</sub>,
                                    β<sub>NC</sub>)</label>
                                <div class="input-group">
                                    <input id="beta1" type="number" step="0.001" class="form-control" value="0.2">
                                    <input id="beta2" type="number" step="0.001" class="form-control" value="0.4">
                                    <input id="beta3" type="number" step="0.001" class="form-control" value="0.6">
                                </div>
                                <div class="small-note mt-1">Lognormal dispersion parameters for DL / SD / NC.</div>
                            </div>

                            <!-- Two separate columns -->
                            <div class="col-6">
                                <label class="form-label">Displacements δ (mm)</label>
                                <textarea id="dispCol" rows="12" class="form-control" spellcheck="false">0
0.598
1.635
3.43
5.225
7.02
8.815
10.61
12.405
14.2
15.995
17.729
18.578
20.048
21.674
23.3
24.925
26.551
28.177
29.803
31.428
33.054
34.68
36.306
37.931
39.557
41.183
42.808
44.434
46.06
47.686
49.311
50.937
52.563
54.188
55.814
57.44
59.066
60.691
62.317
63.943
65.568
67.194
68.82
70.446
72.066
73.68
75.288</textarea>
                                <div class="small-note mt-1">One value per line (commas/spaces/tabs also accepted).
                                </div>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Forces V<sub>b</sub> (kN)</label>
                                <textarea id="forceCol" rows="12" class="form-control" spellcheck="false">0
264.5
722.7
1516.3
2309.9
3103.5
3897.1
4690.7
5484.3
6277.9
7071.5
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7166.3
7145.8
7105
7038.9</textarea>
                                <div class="small-note mt-1">If lengths differ, the shorter list is used.</div>
                            </div>

                            <!-- Manual DS by IDs -->
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="useDsIds">
                                    <label class="form-check-label" for="useDsIds">Use DS by point IDs (override auto
                                        DS)</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row g-2">
                                    <div class="col-4">
                                        <label class="form-label">DS1 ID</label>
                                        <input id="ds1_id" type="number" min="1" step="1" class="form-control"
                                            placeholder="e.g., 3">
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label">DS2 ID</label>
                                        <input id="ds2_id" type="number" min="1" step="1" class="form-control"
                                            placeholder="e.g., 10">
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label">DS3 ID</label>
                                        <input id="ds3_id" type="number" min="1" step="1" class="form-control"
                                            placeholder="e.g., 20">
                                    </div>
                                </div>
                                <div class="small-note mt-1">IDs refer to rows in the points table (first row = ID 1).
                                </div>
                            </div>

                            <!-- Manual LAST (for bilinear) by ID -->
                            <div class="col-12 mt-2">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="useLastId">
                                    <label class="form-check-label" for="useLastId">Use custom LAST point (for bilinear)
                                        by ID</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="form-label">LAST ID</label>
                                        <input id="last_id" type="number" min="2" step="1" class="form-control"
                                            placeholder="e.g., 48">
                                    </div>
                                </div>
                                <div class="small-note mt-1">Bilinear uses (d<sub>m</sub>, F<sub>obs</sub>) at this ID.
                                </div>
                            </div>

                            <!-- Energy basis selector -->
                            <div class="col-12 mt-2">
                                <label class="form-label">Energy basis for bilinearization</label>
                                <select id="energyMode" class="form-select">
                                    <option value="full" selected>Full curve (all points)</option>
                                    <option value="last">Up to LAST ID</option>
                                </select>
                                <div class="small-note mt-1">Equal-energy area E is taken over this range.</div>
                            </div>

                            <div class="col-12 d-grid gap-2">
                                <button id="computeBtn" class="btn btn-primary btn-lg">Compute</button>
                                <button id="downloadBtn" class="btn btn-outline-secondary">Download Results
                                    (JSON)</button>
                            </div>
                        </div>

                        <hr class="my-4">
                        <h2 class="h6 text-uppercase text-muted">Computed (mm)</h2>
                        <div class="row g-3">
                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds1_raw" class="form-control" readonly>
                                    <label>DS1 (dy)</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds2_raw" class="form-control" readonly>
                                    <label>DS2 (mean)</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds3_raw" class="form-control" readonly>
                                    <label>DS3 (dm)</label>
                                </div>
                            </div>

                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds1_g" class="form-control" readonly>
                                    <label>DS1_g</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds2_g" class="form-control" readonly>
                                    <label>DS2_g</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-floating">
                                    <input id="ds3_g" class="form-control" readonly>
                                    <label>DS3_g</label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Points table -->
                <div class="card mt-4">
                    <div class="card-body">
                        <h2 class="h6 mb-3">Points Table</h2>
                        <div class="table-responsive" style="max-height: 360px; overflow:auto;">
                            <table class="table table-sm table-striped align-middle mb-0" id="pointsTable">
                                <thead class="sticky-head">
                                    <tr>
                                        <th>ID</th>
                                        <th>δ (mm)</th>
                                        <th>V<sub>b</sub> (kN)</th>
                                        <th>Slope to prev (kN/mm)</th>
                                        <th>V<sub>b</sub> (% of max)</th>
                                    </tr>
                                </thead>
                                <tbody><!-- filled dynamically --></tbody>
                            </table>
                        </div>
                        <div class="small-note mt-2">Slope at row i≥2 is
                            (V<sub>b,i</sub>−V<sub>b,i−1</sub>)/(δ<sub>i</sub>−δ<sub>i−1</sub>); first row blank.</div>
                    </div>
                </div>

            </div>

            <!-- Right: Charts -->
            <div class="col-lg-7">
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="h5 mb-3">Pushover curve & Bilinear + DS</h2>
                        <div id="pushoverPlot" style="height:420px;"></div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="h5 mb-3">Fragility Curves</h2>
                        <div id="fragilityPlot" style="height:420px;"></div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="h5 mb-3">Slope dV<sub>b</sub>/dδ vs Displacement</h2>
                        <div id="anglePlot" style="height:420px;"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h2 class="h5 mb-3">V<sub>b</sub> as % of V<sub>b,max</sub></h2>
                        <div id="percentPlot" style="height:420px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /** ---------- Helpers ---------- **/
        function parseColumn(text) {
            return text
                .split(/\r?\n/)
                .map(r => r.trim())
                .filter(Boolean)
                .map(line => line.split(/[,\t ]+/))
                .flat()
                .map(s => s.replace(',', '.'))
                .map(Number)
                .filter(v => Number.isFinite(v));
        }

        function parseKampFromTwoCols(dispText, forceText) {
            const x0 = parseColumn(dispText);
            const y0 = parseColumn(forceText);
            const n = Math.min(x0.length, y0.length);
            const x = x0.slice(0, n);
            const y = y0.slice(0, n);
            if (n < 2) return { x: [], y: [] };
            const idx = [...x.keys()].sort((a, b) => x[a] - x[b]);
            return { x: idx.map(i => x[i]), y: idx.map(i => y[i]) };
        }

        // Trapezoidal area up to inclusive last index
        function trapz(x, y, lastIdxInclusive) {
            let A = 0;
            for (let i = 1; i <= lastIdxInclusive; i++) {
                const dx = x[i] - x[i - 1];
                A += 0.5 * (y[i] + y[i - 1]) * dx;
            }
            return A;
        }

        function uniqueLastIndexUpTo(x, k) {
            let last = Math.min(k, x.length - 1);
            if (last > 0 && x[last] === x[last - 1]) last -= 1;
            return last;
        }

        function erf(z) {
            const sign = z < 0 ? -1 : 1;
            z = Math.abs(z);
            const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429;
            const p = 0.3275911;
            const t = 1 / (1 + p * z);
            const y = 1 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);
            return sign * y;
        }

        function fmt3(v) { return Number.isFinite(v) ? Number(v).toFixed(3) : ''; }

        /** Slopes between consecutive points and their mid-δ for plotting **/
        function segmentSlopes(x, y) {
            const slopes = [];
            const xmid = [];
            for (let i = 1; i < x.length; i++) {
                const dx = x[i] - x[i - 1];
                const dy = y[i] - y[i - 1];
                slopes.push(dx !== 0 ? dy / dx : null);
                xmid.push(0.5 * (x[i] + x[i - 1]));
            }
            return { slopes, xmid };
        }

        /** ---------- Core compute ---------- **/
        function computeAll() {
            const grd = Number(document.getElementById('grd').value);
            const dt = Number(document.getElementById('dt').value);
            const betas = [
                Number(document.getElementById('beta1').value),
                Number(document.getElementById('beta2').value),
                Number(document.getElementById('beta3').value)
            ];

            const { x, y } = parseKampFromTwoCols(
                document.getElementById('dispCol').value,
                document.getElementById('forceCol').value
            );
            if (x.length < 3) { alert('Please provide at least 3 rows in both columns.'); return; }

            // Table helpers
            const { slopes, xmid } = segmentSlopes(x, y);
            const yMax = y.reduce((m, v) => Math.max(m, v), -Infinity);
            const pct = y.map(v => (yMax > 0 ? (( v - yMax) / yMax) * 100 : 0));


            // ----- Bilinearization (horizontal post-yield; MATLAB-consistent) -----
            const useLastId = document.getElementById('useLastId').checked;
            const lastIdInp = parseInt(document.getElementById('last_id').value, 10);
            const n = x.length;

            let lastCand = n - 1;
            if (useLastId && Number.isInteger(lastIdInp) && lastIdInp >= 2 && lastIdInp <= n) {
                lastCand = lastIdInp - 1; // 0-based
            }
            const last = uniqueLastIndexUpTo(x, lastCand);
            const dm = x[last];
            const Fy_obs = y[last];

            // Energy basis
            const energyMode = document.getElementById('energyMode').value; // 'full' | 'last'
            const E_basis = (energyMode === 'full') ? trapz(x, y, x.length - 1) : trapz(x, y, last);

            // Classic horizontal:
            const dy = 2 * (dm - (E_basis / Fy_obs));
            const Fy = Fy_obs;
            const bilinear = [
                { x: x[0], y: y[0] },
                { x: dy, y: Fy },
                { x: dm, y: Fy }
            ];

            // ----- DS (auto, with optional override by IDs) -----
            const useIds = document.getElementById('useDsIds').checked;
            const ds1_id = parseInt(document.getElementById('ds1_id').value, 10);
            const ds2_id = parseInt(document.getElementById('ds2_id').value, 10);
            const ds3_id = parseInt(document.getElementById('ds3_id').value, 10);
            const validId = k => Number.isInteger(k) && k >= 1 && k <= n;

            let DS1 = dy;
            let DS3 = dm;
            let DS2 = 0.5 * (DS1 + DS3);
            if (useIds) {
                if (validId(ds1_id)) DS1 = x[ds1_id - 1];
                if (validId(ds3_id)) DS3 = x[ds3_id - 1];
                DS2 = validId(ds2_id) ? x[ds2_id - 1] : 0.5 * (DS1 + DS3);
            }

            const DS1_g = DS1 / grd;
            const DS2_g = DS2 / grd;
            const DS3_g = DS3 / grd;

            // Update DS fields
            document.getElementById('ds1_raw').value = fmt3(DS1);
            document.getElementById('ds2_raw').value = fmt3(DS2);
            document.getElementById('ds3_raw').value = fmt3(DS3);
            document.getElementById('ds1_g').value = fmt3(DS1_g);
            document.getElementById('ds2_g').value = fmt3(DS2_g);
            document.getElementById('ds3_g').value = fmt3(DS3_g);

            // Plots
            drawPushover(x, y, bilinear, { DS1_g, DS2_g, DS3_g, dt });
            drawFragility({ DS1_g, DS2_g, DS3_g }, betas, dt);
            drawSlopes(xmid, slopes);
            drawPercent(x, y, pct, yMax);

            // Return results for JSON
            return {
                inputs: {
                    grd, dt, betas, useDsIds: useIds, ds_ids: { ds1_id, ds2_id, ds3_id },
                    useLastId, last_id: lastIdInp || null, energyMode
                },
                summary: { dm, Fy_obs, dy, DS1, DS2, DS3, DS1_g, DS2_g, DS3_g, last_index_1based: last + 1, E_basis, Vb_max: yMax },
                bilinear,
                points: x.map((xi, i) => ({
                    id: i + 1,
                    delta_mm: xi,
                    Vb_kN: y[i],
                    slope_to_prev_kN_per_mm: i ? slopes[i - 1] : null,
                    Vb_pct_of_max: pct[i]
                }))
            };
        }

        /** ---------- Table ---------- **/
        function renderPointsTable(x, y, slopes) {
            // percent will be computed in computeAll, so we don't render here.
        }

        /** ---------- Plot: Pushover (MATLAB-like) ---------- **/
        function drawPushover(x, y, bilinear, lines) {
            const ids = x.map((_, i) => i + 1);

            const pushover = {
                x, y,
                mode: 'lines',
                name: 'Pushover',
                line: { width: 1.2, color: 'blue' },
                customdata: ids.map(id => [id]),
                hovertemplate: 'ID: %{customdata[0]}<br>δ: %{x:.3f} mm<br>Vb: %{y:.3f} kN<extra>Pushover</extra>'
            };

            const bilin = {
                x: bilinear.map(p => p.x),
                y: bilinear.map(p => p.y),
                mode: 'lines',
                name: 'Bilinear',
                line: { width: 1.5, color: 'red' },
                hovertemplate: 'δ: %{x:.3f} mm<br>Vb: %{y:.3f} kN<extra>Bilinear</extra>'
            };

            const vlines = [
                { x: lines.DS1_g, color: 'green', label: 'DS1' },
                { x: lines.DS2_g, color: 'magenta', label: 'DS2' },
                { x: lines.DS3_g, color: 'black', label: 'DS3' },
                { x: lines.dt, color: 'teal', label: 'd_t' }
            ];

            const shapes = vlines.map(v => ({
                type: 'line',
                x0: v.x, x1: v.x,
                y0: 0, y1: 1,
                xref: 'x', yref: 'paper',
                line: { width: 2, dash: 'dash', color: v.color }
            }));

            const annotations = vlines.map(v => ({
                x: v.x, y: 0.5, xref: 'x', yref: 'paper',
                text: v.label, showarrow: false,
                font: { size: 12, color: v.color },
                bgcolor: 'rgba(255,255,255,0.7)',
                bordercolor: 'rgba(0,0,0,0)',
                textangle: 0
            }));

            const layout = {
                margin: { l: 70, r: 20, t: 20, b: 60 },
                xaxis: { title: 'Μετακίνηση κόμβου ελέγχου – δ (mm)' },
                yaxis: { title: 'Τέμνουσα Βάσης V_b (kN)' },
                legend: { orientation: 'h', x: 0, y: -0.2 },
                shapes,
                annotations,
                hovermode: 'closest'
            };

            Plotly.newPlot('pushoverPlot', [pushover, bilin], layout, { responsive: true });
        }

         /** ---------- Plot: Fragility ---------- **/
function drawFragility(Sd_ds, betas, dt) {
    // autoscale Sd range
    const Sd_min = 0;
    const Sd_max = 1.2 * Math.max(Sd_ds.DS3_g, dt); // 20% headroom
    const N = 300;
    const Sd = Array.from({length: N}, (_, i) =>
        Sd_min + (Sd_max - Sd_min) * i / (N - 1)
    );

    function Phi(z) { return 0.5 * (1 + erf(z / Math.SQRT2)); }

    const labels = ['DL – Damage Limitation', 'SD – Significant Damage', 'NC – Near Collapse'];
    const keys = ['DS1_g', 'DS2_g', 'DS3_g'];

    const traces = keys.map((k, i) => {
        const Sd_th = Sd_ds[k];
        const beta = betas[i];
        const P = Sd.map(s => Phi(Math.log(s / Sd_th) / beta) * 100);
        return {
            x: Sd,
            y: P,
            mode: 'lines',
            name: labels[i],
            line: { width: 2 },
            hovertemplate:
                'δ: %{x:.3f} mm<br>P(exceed): %{y:.2f}%<extra>' + labels[i] + '</extra>'
        };
    });

    // layout and plotting left unchanged in your code
    const layout = {
        margin:{l:70,r:20,t:20,b:60},
        xaxis:{ title:'Μετακίνηση δ (mm)', autorange:true },
        yaxis:{ title:'Πιθανότητα υπέρβασης (%)', autorange:true },
        legend:{orientation:'v', x:1.02, xanchor:'left', y:1},
        shapes:[{
          type:'line', x0:dt, x1:dt, y0:0, y1:1, xref:'x', yref:'paper',
          line:{width:2, dash:'dash', color:'red'}
        }],
        annotations:[{
          x:dt, y:1.02, xref:'x', yref:'paper', showarrow:false,
          font:{size:12, color:'red'},
          text:`Performance Point (${dt.toFixed(2)} mm)`
        }],
        hovermode:'closest'
    };

    Plotly.newPlot('fragilityPlot', traces, layout, {responsive:true});
}

        /** ---------- Plot: Slopes (angle) ---------- **/
        function drawSlopes(xmid, slopes) {
            const segIds = slopes.map((_, i) => i + 1);
            const trace = {
                x: xmid,
                y: slopes,
                mode: 'lines+markers',
                name: 'dVb/dδ',
                line: { width: 2 },
                marker: { size: 5 },
                customdata: segIds.map(id => [id]),
                hovertemplate: 'Seg ID: %{customdata[0]}<br>δ(mid): %{x:.3f} mm<br>slope: %{y:.6f} kN/mm<extra>dVb/dδ</extra>'
            };
            const layout = {
                margin: { l: 70, r: 20, t: 20, b: 60 },
                xaxis: { title: 'Μετακίνηση δ (mm)' },
                yaxis: { title: 'Κλίση dVb/dδ (kN/mm)' },
                hovermode: 'closest'
            };
            Plotly.newPlot('anglePlot', [trace], layout, { responsive: true });
        }

        /** ---------- Plot: Percent of max Vb ---------- **/
        function drawPercent(x, y, pct, yMax) {
            const ids = x.map((_, i) => i + 1);
            const trace = {
                x: x,
                y: pct,
                mode: 'lines+markers',
                name: '(Vb_max-Vb) / Vb_max (%)',
                line: { width: 2 },
                marker: { size: 5 },
                customdata: ids.map((id, i) => [id, y[i]]),
                hovertemplate:
                    'ID: %{customdata[0]}<br>δ: %{x:.3f} mm<br>Vb: %{customdata[1]:.3f} kN' +
                    '<br>% of max: %{y:.2f}%<extra>Vb% of max</extra>'
            };
            const layout = {
                margin: { l: 70, r: 20, t: 20, b: 60 },
                xaxis: { title: 'Μετακίνηση δ (mm)', autorange:true  },
                yaxis: { title: 'Vb (% of Vb_max)', autorange:true },
                hovermode: 'closest'
            };
            Plotly.newPlot('percentPlot', [trace], layout, { responsive: true });
        }

        /** ---------- UI wiring ---------- **/
        let lastResults = null;
        document.getElementById('computeBtn').addEventListener('click', () => {
            try {
                lastResults = computeAll();

                // Render the table here (needs pct, so rebuild quickly from lastResults)
                const tbody = document.querySelector('#pointsTable tbody');
                tbody.innerHTML = '';
                if (lastResults && lastResults.points) {
                    for (const p of lastResults.points) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${fmt3(p.delta_mm)}</td>
          <td>${fmt3(p.Vb_kN)}</td>
          <td>${p.id === 1 ? '' : fmt3(p.slope_to_prev_kN_per_mm)}</td>
          <td>${Number.isFinite(p.Vb_pct_of_max) ? p.Vb_pct_of_max.toFixed(2) : ''}</td>
        `;
                        tbody.appendChild(tr);
                    }
                }
            } catch (e) {
                console.error(e);
                alert('Computation failed. Please check inputs.');
            }
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (!lastResults) { alert('Compute first.'); return; }
            const blob = new Blob([JSON.stringify(lastResults, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'pushover_fragility_results.json';
            a.click();
            URL.revokeObjectURL(a.href);
        });

        // Auto-recompute on changes
        ['useDsIds', 'useLastId', 'ds1_id', 'ds2_id', 'ds3_id', 'last_id', 'energyMode']
            .forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    document.getElementById('computeBtn').click();
                });
            });

        // Auto-compute once on load
        window.addEventListener('load', () => {
            document.getElementById('computeBtn').click();
        });
    </script>
<footer class="footer mt-5 py-3">
  <div class="container text-center small">
    Pushover Bilinearization & Fragility by <b>Manos Papapavlou</b></span>
  </div>
</footer>
</body>

</html>